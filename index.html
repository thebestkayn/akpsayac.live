<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AKP Sayaç</title>

    <link rel="icon" href="favicon.ico" type="image/x-icon" />

    <meta name="description" content="AKP iktidarı başlangıcından bugüne geçen süreyi canlı olarak gösteren sayaç." />
    <meta property="og:title" content="AKP Sayaç" />
    <meta property="og:description" content="AKP iktidarı başlangıcından bugüne geçen süre." />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="tr_TR" />
    <meta name="theme-color" content="#0ea5e9" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        html,
        body {
            height: 100%
        }

        body {
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif
        }

        .stat {
            min-width: 5.5rem
        }

        .glass {
            backdrop-filter: saturate(180%) blur(8px);
            background: rgba(255, 255, 255, .06)
        }

        .tick {
            transition: transform 150ms ease
        }

        .tick.flash {
            transform: scale(1.06)
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>

<body class="min-h-full bg-slate-900 text-slate-100">
    <div class="max-w-5xl mx-auto p-6">
        <header class="flex items-center justify-between gap-4">
            <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">AKP Sayaç</h1>
            <button id="themeBtn"
                class="px-3 py-1.5 rounded-xl border border-slate-700 hover:border-slate-500 text-sm">Tema</button>
        </header>

        <section class="mt-6 grid lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 glass rounded-2xl border border-slate-800 p-6">
                <h2 class="text-lg font-semibold text-slate-300">Başlangıç</h2>
                <div class="mt-3 flex flex-wrap gap-2">
                    <button data-preset="akp" class="preset btn">AKP Hükûmeti (18 Kasım 2002)</button>
                    <button data-preset="pm" class="preset btn">Erdoğan Başbakan (14 Mart 2003)</button>
                    <button data-preset="pres" class="preset btn">Erdoğan Cumhurbaşkanı (28 Ağustos 2014)</button>
                </div>

                <div class="mt-5 grid md:grid-cols-2 gap-4">
                    <label class="block text-sm">Tarih ve Saat (Yerel):
                        <input id="startInput" type="datetime-local"
                            class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
                    </label>
                    <label class="block text-sm">Zaman Dilimi (IANA):
                        <input id="tzInput" type="text"
                            class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2"
                            placeholder="Europe/Istanbul" />
                    </label>
                </div>
                <div class="mt-3 flex gap-3">
                    <button id="applyBtn"
                        class="px-4 py-2 rounded-xl bg-sky-600 hover:bg-sky-500 font-semibold">Uygula</button>
                    <button id="shareBtn"
                        class="px-4 py-2 rounded-xl border border-slate-700 hover:border-slate-500">Paylaşım
                        Bağlantısı</button>
                    <span id="shareMsg" class="text-sm text-slate-400"></span>
                </div>
            </div>

            <div class="glass rounded-2xl border border-slate-800 p-6">
                <h2 class="text-lg font-semibold text-slate-300">Bilgi</h2>
                <ul class="mt-3 space-y-2 text-sm text-slate-300">
                    <li>Bu sayaç seçtiğiniz başlangıç anından bugüne geçen <strong>yıl / gün / saat / dakika /
                            saniye</strong> değerlerini canlı hesaplar.</li>
                    <li>"Paylaşım Bağlantısı" ile aynı ayarları arkadaşlarınıza gönderebilirsiniz.</li>
                    <li>Zaman Dilimi için varsayılan: <code>Europe/Istanbul</code>.</li>
                </ul>
            </div>
        </section>

        <main class="mt-8">
            <div class="glass rounded-3xl border border-slate-800 p-6 md:p-8">
                <h2 id="label" class="text-xl md:text-2xl font-bold text-slate-200">AKP Hükûmeti başlangıcından beri
                    geçen süre</h2>
                <div id="counter" class="mt-6 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3">
                    <!-- JS dolduracak -->
                </div>
                <p id="since" class="mt-4 text-sm text-slate-400"></p>
            </div>
        </main>

        <footer class="mt-10 text-center text-xs text-slate-500">
            <p>Kaynak tarihleri kamuya açık bilgilerdir. Bu sayaç taraflı bir sayaç ve en büyük isteği bir gün durmak.
            </p>
            <p class="mt-1">© <span id="year"></span> Sayaç</p>
        </footer>
    </div>

    <script>
        const $ = (s, root = document) => root.querySelector(s);
        const $$ = (s, root = document) => Array.from(root.querySelectorAll(s));
        const pad = (n) => String(n).padStart(2, '0');

        const elements = {
            counter: $('#counter'),
            since: $('#since'),
            label: $('#label'),
            startInput: $('#startInput'),
            tzInput: $('#tzInput'),
            applyBtn: $('#applyBtn'),
            shareBtn: $('#shareBtn'),
            shareMsg: $('#shareMsg'),
            themeBtn: $('#themeBtn'),
        };

        const PRESETS = {
            akp: { date: '2002-11-18T12:00', label: 'AKP Hükûmeti başlangıcından beri geçen süre' },
            pm: { date: '2003-03-14T12:00', label: 'Erdoğan Başbakan olduğu andan beri geçen süre' },
            pres: { date: '2014-08-28T12:00', label: 'Erdoğan Cumhurbaşkanı olduğu andan beri geçen süre' }
        };

        const DEFAULT_TZ = 'Europe/Istanbul';

        const params = new URLSearchParams(location.search);
        const startParam = params.get('start');
        const labelParam = params.get('label');
        const tzParam = params.get('tz');

        let state = {
            startLocal: startParam || PRESETS.akp.date,
            label: labelParam || PRESETS.akp.label,
            tz: tzParam || DEFAULT_TZ,
        };

        function initUI() {
            elements.startInput.value = state.startLocal;
            elements.tzInput.value = state.tz;
            elements.label.textContent = state.label;
            $('#year').textContent = new Date().getFullYear();
            buildCounter();
        }

        function buildCounter() {
            const units = [
                ['years', 'Yıl'],
                ['days', 'Gün'],
                ['hours', 'Saat'],
                ['minutes', 'Dakika'],
                ['seconds', 'Saniye'],
                ['milliseconds', 'Milisaniye'],
            ];
            elements.counter.innerHTML = '';
            for (const [key, label] of units) {
                const card = document.createElement('div');
                card.className = 'stat rounded-2xl border border-slate-800 glass p-4 text-center';
                card.innerHTML = `
          <div class="text-3xl md:text-4xl font-extrabold tabular-nums leading-none">
            <span id="val-${key}">00</span>
          </div>
          <div class="mt-1 text-xs text-slate-400">${label}</div>
        `;
                elements.counter.appendChild(card);
            }
        }

        // localStr: "YYYY-MM-DDTHH:mm" bu saat, verilen IANA TZ'nin duvar saati kabul edilir
        function toZonedDate(localStr, tz) {
            const [d, t] = localStr.split('T');
            const [y, m, dd] = d.split('-').map(Number);
            const [hh, mm] = (t || '00:00').split(':').map(Number);

            // Bu duvar saatinin UTC offset'ini bul
            // 1) Aynı an için "UTC" referanslı bir Date üret
            const guessUtc = new Date(Date.UTC(y, m - 1, dd, hh || 0, mm || 0, 0, 0));
            // 2) Bu anın ilgili TZ'deki offset'ini oku
            const fmt = new Intl.DateTimeFormat('en-US', {
                timeZone: tz,
                timeZoneName: 'shortOffset',
                hour12: false,
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit'
            });
            const parts = fmt.formatToParts(guessUtc);
            const tzName = parts.find(p => p.type === 'timeZoneName')?.value || 'UTC';
            const match = tzName.match(/UTC([+-])(\d{1,2})(?::?(\d{2}))?/);

            let offsetMin = 0;
            if (match) {
                const sign = match[1] === '-' ? -1 : 1;
                const h = parseInt(match[2] || '0', 10);
                const mOff = parseInt(match[3] || '0', 10);
                offsetMin = sign * (h * 60 + mOff);
            }
            // TZ duvar saatini UTC'ye çevir
            return new Date(Date.UTC(y, m - 1, dd, hh || 0, mm || 0, 0, 0) - offsetMin * 60 * 1000);
        }

        function diffBreakdown(from, to) {
            const sign = to < from ? -1 : 1;
            const start = new Date(from);
            const end = new Date(to);

            // Yılları tam yıl dönümlerine göre hesapla
            let years = end.getUTCFullYear() - start.getUTCFullYear();
            const anniv = Date.UTC(
                start.getUTCFullYear() + years,
                start.getUTCMonth(),
                start.getUTCDate(),
                start.getUTCHours(),
                start.getUTCMinutes(),
                start.getUTCSeconds(),
                start.getUTCMilliseconds()
            );
            if (to < anniv) years--;

            const afterYears = Date.UTC(
                start.getUTCFullYear() + years,
                start.getUTCMonth(),
                start.getUTCDate(),
                start.getUTCHours(),
                start.getUTCMinutes(),
                start.getUTCSeconds(),
                start.getUTCMilliseconds()
            );

            let rest = Math.abs(to - afterYears);

            const dayMs = 24 * 60 * 60 * 1000;
            const hourMs = 60 * 60 * 1000;
            const minMs = 60 * 1000;

            const days = Math.floor(rest / dayMs); rest -= days * dayMs;
            const hours = Math.floor(rest / hourMs); rest -= hours * hourMs;
            const minutes = Math.floor(rest / minMs); rest -= minutes * minMs;
            const seconds = Math.floor(rest / 1000); rest -= seconds * 1000;
            const millis = Math.floor(rest);

            return { sign, years, days, hours, minutes, seconds, millis };
        }

        let lastVals = {};
        function render(now) {
            const start = toZonedDate(state.startLocal, state.tz);
            const d = diffBreakdown(start, now);
            const fmtStart = new Intl.DateTimeFormat('tr-TR', { timeZone: state.tz, dateStyle: 'full', timeStyle: 'short' }).format(start);
            elements.since.textContent = `Başlangıç: ${fmtStart} (${state.tz})`;

            const entries = [
                ['years', d.years],
                ['days', d.days],
                ['hours', pad(d.hours)],
                ['minutes', pad(d.minutes)],
                ['seconds', pad(d.seconds)],
                ['milliseconds', String(d.millis).padStart(3, '0')],
            ];
            for (const [k, v] of entries) {
                const el = document.getElementById('val-' + k);
                if (!el) continue;
                const prev = lastVals[k];
                if (prev !== v) {
                    el.textContent = v;
                    el.classList.add('tick', 'flash');
                    setTimeout(() => el.classList.remove('flash'), 120);
                    lastVals[k] = v;
                }
            }
        }

        function startLoop() {
            function frame() {
                render(new Date());
                requestAnimationFrame(frame);
            }
            requestAnimationFrame(frame);
        }

        // Preset butonları
        $$('.preset').forEach(btn => {
            btn.classList.add('px-3', 'py-1.5', 'rounded-xl', 'border', 'border-slate-700', 'hover:border-slate-500', 'text-sm');
            btn.addEventListener('click', () => {
                const p = PRESETS[btn.dataset.preset];
                state.startLocal = p.date;
                state.label = p.label;
                elements.startInput.value = state.startLocal;
                elements.label.textContent = state.label;
                updateQueryString();
            });
        });

        elements.applyBtn.addEventListener('click', () => {
            const v = elements.startInput.value?.trim();
            const tz = elements.tzInput.value?.trim() || DEFAULT_TZ;
            if (v) state.startLocal = v;
            state.tz = tz;
            elements.label.textContent = state.label;
            updateQueryString();
        });

        function updateQueryString() {
            const q = new URLSearchParams({ start: state.startLocal, tz: state.tz, label: state.label });
            const newUrl = `${location.pathname}?${q.toString()}`;
            history.replaceState(null, '', newUrl);
        }

        elements.shareBtn.addEventListener('click', async () => {
            updateQueryString();
            try {
                await navigator.clipboard.writeText(location.href);
                elements.shareMsg.textContent = 'Bağlantı kopyalandı!';
                setTimeout(() => (elements.shareMsg.textContent = ''), 2500);
            } catch {
                elements.shareMsg.textContent = 'Bağlantıyı adres çubuğundan kopyalayın';
            }
        });

        elements.themeBtn.addEventListener('click', () => {
            if (document.documentElement.classList.contains('light')) {
                document.body.classList.add('bg-slate-900', 'text-slate-100');
                document.body.classList.remove('bg-slate-50', 'text-slate-900');
                document.documentElement.classList.remove('light');
            } else {
                document.body.classList.remove('bg-slate-900', 'text-slate-100');
                document.body.classList.add('bg-slate-50', 'text-slate-900');
                document.documentElement.classList.add('light');
            }
        });

        initUI();
        startLoop();
    </script>
</body>

</html>